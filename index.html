<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Brains Welcome</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-slate-50 text-slate-800 transition-colors duration-300;
        }
        /* Dark mode styles */
        .dark body {
            @apply bg-slate-900 text-slate-200;
        }
        .dark .bg-white {
            @apply bg-slate-800;
        }
        .dark .bg-blue-50 {
            @apply bg-slate-800 border-b border-slate-700;
        }
        .dark .text-gray-900 {
            @apply text-slate-100;
        }
        .dark .text-gray-700 {
            @apply text-slate-300;
        }
        .dark .text-gray-600 {
            @apply text-slate-400;
        }
        .dark .shadow-sm {
             box-shadow: 0 1px 2px 0 rgba(255, 255, 255, 0.05);
        }
        .dark .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.05), 0 2px 4px -2px rgba(255, 255, 255, 0.05);
        }
        .dark .hover\:shadow-lg:hover {
            box-shadow: 0 10px 15px -3px rgba(255, 255, 255, 0.05), 0 4px 6px -4px rgba(255, 255, 255, 0.05);
        }
        .dark .border-gray-300 {
            @apply border-slate-600;
        }
        .dark .bg-gray-200 {
            @apply bg-slate-700;
        }
        .dark .hover\:bg-gray-300:hover {
            @apply hover:bg-slate-600;
        }
        .dark .bg-gray-900 {
            @apply bg-black;
        }
        .dark #modal-overlay {
            background-color: rgba(0, 0, 0, 0.75);
        }
        .dark .bg-blue-100 { @apply bg-blue-900/50; }
        .dark .text-blue-800 { @apply text-blue-300; }
        .dark .bg-green-100 { @apply bg-green-900/50; }
        .dark .text-green-800 { @apply text-green-300; }
        .dark .bg-purple-100 { @apply bg-purple-900/50; }
        .dark .text-purple-800 { @apply text-purple-300; }

        /* Accessibility */
        :focus-visible {
            @apply outline-offset-2 rounded-md outline-2 outline-blue-500;
        }
        
        /* Animations */
        #info-modal-container, #info-modal, #results-grid, .resource-card {
            transition: all 0.3s ease-in-out;
        }
        #info-modal-container.hidden #info-modal {
            @apply transform scale-95 opacity-0 pointer-events-none;
        }
        .resource-card:hover {
            @apply transform scale-[1.03] shadow-lg;
        }
        #results-grid.loading {
            @apply opacity-50;
        }
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }
        
        /* Layout */
        .filter-sidebar {
            position: sticky;
            top: 6rem;
            height: calc(100vh - 8rem);
            overflow-y: auto;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <a href="#" class="flex items-center space-x-2">
                        <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                        <span class="text-xl font-bold text-gray-900 hidden sm:inline">All Brains Welcome</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="search" id="search-bar" placeholder="Search resources..." class="w-48 sm:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-full text-sm focus:ring-blue-500 focus:border-blue-500 bg-slate-100 dark:bg-slate-700 dark:border-slate-600">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                    </div>
                    <button id="theme-toggle" type="button" class="p-2 rounded-full text-gray-500 hover:bg-gray-100 dark:hover:bg-slate-700">
                        <svg id="theme-toggle-dark-icon" class="h-5 w-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        <svg id="theme-toggle-light-icon" class="h-5 w-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 14.95a1 1 0 010-1.414l.707-.707a1 1 0 011.414 1.414l-.707.707a1 1 0 01-1.414 0zM3 11a1 1 0 100-2H2a1 1 0 100 2h1z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Description Section -->
    <section class="bg-blue-50 border-b border-blue-200">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <h1 class="text-2xl font-bold text-gray-900 mb-2 text-center">Neurodiversity & Assistive Technology Resource Hub</h1>
            <p class="text-center text-gray-700 max-w-4xl mx-auto">
                Welcome to the All Brains Welcome resource hub. This page is designed to help you discover a wide range of tools, apps, and strategies that can support various aspects of neurodiversity. Use the filters on the left to find resources tailored to your specific needs, whether it's for organization, focus, communication, or something else. Click on any resource card to learn more about it.
            </p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
            
            <!-- Filters Section -->
            <aside class="lg:col-span-1 mb-8 lg:mb-0">
                <div class="bg-white p-6 rounded-lg shadow-sm filter-sidebar">
                    <h2 class="text-xl font-semibold mb-4 text-gray-900">Filters</h2>
                    <form id="filter-form">
                        <!-- Filter groups will be inserted here -->
                    </form>
                </div>
            </aside>

            <!-- Results Section -->
            <section class="lg:col-span-3">
                <div class="bg-white p-4 rounded-lg shadow-sm mb-4 flex items-center justify-between">
                    <h2 id="results-count" class="text-lg font-medium text-gray-700">Loading results...</h2>
                </div>
                <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-6">
                    <!-- Resource cards will be inserted here -->
                </div>
                <div id="no-results" class="hidden text-center py-16"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" /></svg><h3 class="mt-2 text-lg font-medium text-gray-900">No Results Found</h3><p class="mt-1 text-sm text-gray-500">Try adjusting your search or filters to find what you're looking for.</p></div>
                <div id="loading-indicator" class="text-center py-16"><svg class="animate-spin mx-auto h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="mt-2 text-gray-600">Loading data...</p></div>
            </section>
        </div>
    </main>

    <!-- Details Modal -->
    <div id="info-modal-container" class="fixed inset-0 z-40 hidden" role="dialog" aria-modal="true">
        <div id="modal-overlay" class="absolute inset-0 bg-gray-900 bg-opacity-75"></div>
        <div class="relative flex items-center justify-center min-h-screen p-4">
            <div id="info-modal" class="bg-white rounded-lg shadow-xl w-full max-w-2xl transform">
                <div class="p-6 sm:p-8">
                    <div class="flex items-start justify-between"><h3 id="modal-title" class="text-2xl font-bold text-gray-900"></h3><button id="modal-close-button" type="button" class="p-1 rounded-full text-gray-400 hover:bg-gray-200 hover:text-gray-600"><span class="sr-only">Close</span><svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></button></div>
                    <div id="modal-content" class="mt-4 space-y-4"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Link Status Notification -->
    <div id="link-notification" class="fixed bottom-5 right-5 bg-slate-800 text-white py-3 px-5 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-500 z-50">
        <p></p>
    </div>

    <!-- JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- Global variables & State ---
        let database = [];
        let activeFilters = { 'Areas of support': [], 'Format': [], 'Price': [] };
        let searchQuery = '';

        // --- Element Selectors ---
        const resultsGrid = document.getElementById('results-grid');
        const resultsCount = document.getElementById('results-count');
        const noResults = document.getElementById('no-results');
        const loadingIndicator = document.getElementById('loading-indicator');
        const filterForm = document.getElementById('filter-form');
        const searchBar = document.getElementById('search-bar');
        const modalContainer = document.getElementById('info-modal-container');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalCloseButton = document.getElementById('modal-close-button');
        const modalOverlay = document.getElementById('modal-overlay');
        const themeToggle = document.getElementById('theme-toggle');
        const linkNotification = document.getElementById('link-notification');

        // --- Functions ---
        
        /**
         * Theme setup: Applies saved theme or system preference.
         */
        const setupTheme = () => {
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                darkIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                lightIcon.classList.remove('hidden');
            }

            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                darkIcon.classList.toggle('hidden');
                lightIcon.classList.toggle('hidden');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            });
        };

        /**
         * Creates and populates filter groups with expand/collapse functionality.
         */
        const createFilters = () => {
            const filterGroups = {
                'Areas of support': { items: [ 'Concentration and Focus', 'Organisation and Time management', 'Impulsivity and Hyperactivity', 'Processing and Memory', 'Communication and Social interaction', 'Routine, Structure, and Change', 'Movement and Co-ordination', 'Writing', 'Reading', 'Numbers and Mathematics', 'Auditory processing', 'Visual processing', 'Sensory sensitivity', 'Self-regulation, Managing Emotions, Confidence, and Self-esteem' ], limit: 4 },
                'Format': { items: [ 'Website', 'App', 'Hybrid system', 'Equipment', 'Software', 'Browser Extension', 'Feature' ], limit: 4 },
                'Price': { items: [ 'Free', 'Paid', 'Free with Paid options' ], limit: null }
            };

            let formHTML = '';
            for (const groupName in filterGroups) {
                const { items, limit } = filterGroups[groupName];
                items.sort();
                formHTML += `<div class="mb-6" id="filter-group-${groupName.replace(/\s+/g, '-')}">
                                <h3 class="font-semibold mb-3 text-gray-700">${groupName}</h3>
                                <div class="space-y-2">`;
                items.forEach((item, index) => {
                    const isHidden = limit && index >= limit;
                    formHTML += `<label class="flex items-center space-x-3 cursor-pointer ${isHidden ? 'hidden' : ''}" data-filter-item>
                                    <input type="checkbox" value="${item}" data-group="${groupName}" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm text-gray-700">${item}</span>
                                 </label>`;
                });
                formHTML += `</div>`;
                if (limit && items.length > limit) {
                    formHTML += `<button type="button" data-action="toggle-filters" class="text-sm text-blue-600 hover:underline mt-2">Show all ${items.length}</button>`;
                }
                formHTML += `</div>`;
            }
            formHTML += `<button type="reset" id="reset-filters" class="w-full px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-md hover:bg-gray-300 transition-colors">Reset Filters</button>`;
            filterForm.innerHTML = formHTML;
        };
        
        /**
         * Filters and displays resources based on active filters and search query.
         */
        const renderResults = () => {
            resultsGrid.classList.add('loading');
            
            setTimeout(() => {
                const anyFilterActive = Object.values(activeFilters).some(arr => arr.length > 0);
                const query = searchQuery.toLowerCase();

                const filteredData = database.filter(item => {
                    const searchMatch = query === '' || item.Name.toLowerCase().includes(query) || item.Summary.toLowerCase().includes(query);
                    const areaMatch = activeFilters['Areas of support'].length === 0 || (Array.isArray(item['Areas of support']) && activeFilters['Areas of support'].every(value => item['Areas of support'].includes(value)));
                    const formatMatch = activeFilters['Format'].length === 0 || (Array.isArray(item['Format']) && activeFilters['Format'].every(value => item['Format'].includes(value)));
                    const priceMatch = activeFilters['Price'].length === 0 || (Array.isArray(item['Price']) && activeFilters['Price'].some(value => item['Price'].includes(value)));
                    return searchMatch && areaMatch && formatMatch && priceMatch;
                });

                resultsGrid.innerHTML = '';
                resultsCount.textContent = `${filteredData.length} Result${filteredData.length !== 1 ? 's' : ''}`;
                noResults.classList.toggle('hidden', filteredData.length > 0);

                filteredData.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'resource-card bg-white rounded-lg shadow-md flex flex-col cursor-pointer';
                    const createBadge = (text, color) => `<span class="inline-block bg-${color}-100 text-${color}-800 text-xs font-medium mr-2 mb-2 px-2.5 py-0.5 rounded-full">${text}</span>`;
                    card.innerHTML = `<div class="p-6 flex-grow"><h3 class="text-xl font-bold text-gray-900 mb-2">${item.Name}</h3><p class="text-gray-600 line-clamp-2 mb-4">${item.Summary}</p></div><div class="p-6 pt-0"><div>${item['Areas of support'].slice(0, 3).map(area => createBadge(area, 'blue')).join('')}${item.Format.map(format => createBadge(format, 'green')).join('')}${item.Price.map(price => createBadge(price, 'purple')).join('')}</div></div>`;
                    card.addEventListener('click', () => showModal(item));
                    resultsGrid.appendChild(card);
                });
                
                resultsGrid.classList.remove('loading');
            }, 300); // Debounce rendering for smoother animation
        };

        /**
         * Displays the modal with resource details.
         */
        const showModal = (item) => {
            modalTitle.textContent = item.Name;
            const detailSection = (title, content) => {
                if (!content || (Array.isArray(content) && content.length === 0)) return '';
                const contentHtml = Array.isArray(content) ? content.map(c => `<li class="py-1">${c}</li>`).join('') : `<p class="whitespace-pre-wrap">${content}</p>`;
                return `<div><h4 class="font-semibold text-gray-700">${title}</h4><div class="text-gray-600 mt-1 ${Array.isArray(content) ? 'list-disc list-inside' : ''}">${contentHtml}</div></div>`;
            };
            modalContent.innerHTML = `${detailSection('Summary', item.Summary)}${detailSection('Further info / notes', item['Further info / notes'])}<button data-link="${item.Link}" class="link-checker-button inline-block mt-4 px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors focus:ring-4 focus:ring-blue-300">Visit Website</button>`;
            modalContainer.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };
        
        /**
         * Hides the modal.
         */
        const hideModal = () => {
            modalContainer.classList.add('hidden');
            document.body.style.overflow = '';
        };
        
        /**
         * Shows a notification toast.
         */
        const showNotification = (message, duration = 3000) => {
            linkNotification.querySelector('p').textContent = message;
            linkNotification.classList.remove('opacity-0', 'translate-y-20');
            setTimeout(() => {
                linkNotification.classList.add('opacity-0', 'translate-y-20');
            }, duration);
        };

        /**
         * Checks a link and shows notifications before opening.
         */
        const checkLink = async (url) => {
            showNotification('Checking link...', 2000);
            try {
                // 'no-cors' mode prevents errors but returns an opaque response.
                // We can't check status, but a successful fetch means the domain is likely reachable.
                await fetch(url, { mode: 'no-cors' });
                showNotification('Link seems active! Redirecting...', 2000);
            } catch (error) {
                showNotification('Could not verify link. Proceed with caution.', 3000);
            }
            setTimeout(() => window.open(url, '_blank', 'noopener,noreferrer'), 500);
        };

        /**
         * Fetches data and initializes the application.
         */
        const initializeApp = async () => {
            try {
                const response = await fetch('database.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                database = await response.json();
                createFilters();
                renderResults();
            } catch (error) {
                console.error("Failed to initialize:", error);
                resultsGrid.innerHTML = `<p class="text-red-500">An error occurred while loading data.</p>`;
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        };

        // --- Initial Setup & Event Listeners ---
        setupTheme();
        initializeApp();

        filterForm.addEventListener('input', e => {
            if (e.target.type === 'checkbox') {
                const { group, value } = e.target.dataset;
                if (e.target.checked) {
                    if (!activeFilters[group].includes(e.target.value)) activeFilters[group].push(e.target.value);
                } else {
                    activeFilters[group] = activeFilters[group].filter(item => item !== e.target.value);
                }
                renderResults();
            }
        });

        filterForm.addEventListener('click', e => {
            if (e.target.dataset.action === 'toggle-filters') {
                const container = e.target.previousElementSibling;
                const allItems = container.querySelectorAll('label[data-filter-item]');
                const isShowingAll = e.target.textContent.startsWith('Show less');
                e.target.textContent = isShowingAll ? `Show all ${allItems.length}` : 'Show less';
                container.querySelectorAll('label[data-filter-item]:nth-child(n+5)').forEach(item => item.classList.toggle('hidden'));
            }
        });

        filterForm.addEventListener('reset', () => {
            activeFilters = { 'Areas of support': [], 'Format': [], 'Price': [] };
            searchQuery = '';
            searchBar.value = '';
            renderResults();
        });
        
        searchBar.addEventListener('input', () => {
            searchQuery = searchBar.value;
            renderResults();
        });

        modalCloseButton.addEventListener('click', hideModal);
        modalOverlay.addEventListener('click', hideModal);
        document.addEventListener('keydown', e => e.key === 'Escape' && !modalContainer.classList.contains('hidden') && hideModal());
        modalContainer.addEventListener('click', e => {
            if (e.target.classList.contains('link-checker-button')) {
                checkLink(e.target.dataset.link);
            }
        });
    });
    </script>
</body>
</html>
