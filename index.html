<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Brains Welcome</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Stylesheet -->
    <style>
        /* Base styles for the entire body */
        body {
            font-family: 'Inter', sans-serif;
            /* A warm, off-white background color inspired by the image */
            background-color: #FFFBF5; 
        }

        /* Custom color variables for Tailwind CSS */
        /* This allows us to use the specific colors from the image within Tailwind's class system */
        :root {
            --color-brand-orange: #F07643;
            --color-brand-gold: #C4A34A;
            --color-brand-purple: #D9C8E5;
            --color-brand-dark-purple: #585076;
        }

        /* Extending Tailwind with our custom colors */
        .bg-brand-orange { background-color: var(--color-brand-orange); }
        .text-brand-orange { color: var(--color-brand-orange); }
        .ring-brand-orange { ring-color: var(--color-brand-orange); }
        .hover\:bg-brand-orange-dark:hover { background-color: #E86A33; } /* A slightly darker orange for hover states */

        .text-brand-dark-purple { color: var(--color-brand-dark-purple); }
        
        .border-brand-purple { border-color: var(--color-brand-purple); }
        
        /* Accessibility: Focus styles for keyboard navigation */
        :focus-visible {
            outline: 3px solid var(--color-brand-orange);
            outline-offset: 2px;
            border-radius: 6px;
        }
        
        /* Class to truncate text to 2 lines */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Animation for the modal transition */
        #info-modal {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        /* State when the modal container is hidden */
        #info-modal-container.hidden #info-modal {
            transform: scale(0.95);
            opacity: 0;
            pointer-events: none;
        }
        
        /* Independent scrolling for filters */
        .filter-sidebar {
            position: sticky;
            top: 6rem; /* Adjust based on header height */
            height: calc(100vh - 8rem); /* Full height minus header and some padding */
            overflow-y: auto;
        }

        /* Reduced motion accessibility */
        @media (prefers-reduced-motion: reduce) {
            #info-modal {
                transition: none;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header Section: Fixed at the top with a subtle shadow for depth -->
    <header class="bg-white/70 backdrop-blur-lg shadow-sm sticky top-0 z-20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-center h-16">
                <!-- Logo / Title -->
                <div class="flex-shrink-0">
                    <a href="#" class="flex items-center space-x-2">
                        <!-- Updated SVG Icon color to match the new theme -->
                        <svg class="h-8 w-8 text-brand-dark-purple" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                        </svg>
                        <span class="text-xl font-bold text-gray-900">All Brains Welcome</span>
                    </a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Description Section -->
    <section class="bg-amber-50 border-b border-amber-100">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <h1 class="text-2xl font-bold text-gray-900 mb-2 text-center">Neurodiversity & Assistive Technology Resource Hub</h1>
            <p class="text-center text-gray-700 max-w-4xl mx-auto">
                Welcome to the All Brains Welcome resource hub. This page is designed to help you discover a wide range of tools, apps, and strategies that can support various aspects of neurodiversity. Use the filters on the left to find resources tailored to your specific needs, whether it's for organization, focus, communication, or something else. Click on any resource card to learn more about it.
            </p>
        </div>
    </section>

    <!-- Main Content Area -->
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
            
            <!-- Filters Section (Left Sidebar) -->
            <aside class="lg:col-span-1 mb-8 lg:mb-0">
                <div class="bg-white p-6 rounded-lg shadow-sm filter-sidebar">
                    <h2 class="text-xl font-semibold mb-4 text-gray-900">Filters</h2>
                    <form id="filter-form">
                        <!-- Areas of Support Filter Group -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3 text-gray-700">Areas of Support</h3>
                            <div id="areas-of-support-filters" class="space-y-2">
                                <!-- Dynamic Checkboxes -->
                            </div>
                        </div>
                        <!-- Format Filter Group -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3 text-gray-700">Format</h3>
                            <div id="format-filters" class="space-y-2">
                                <!-- Dynamic Checkboxes -->
                            </div>
                        </div>
                        <!-- Price Filter Group -->
                         <div class="mb-6">
                            <h3 class="font-semibold mb-3 text-gray-700">Price</h3>
                            <div id="price-filters" class="space-y-2">
                                <!-- Dynamic Checkboxes -->
                            </div>
                        </div>
                        <!-- Reset Filters Button -->
                        <button type="reset" id="reset-filters" class="w-full px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-md hover:bg-gray-300 transition-colors">
                            Reset Filters
                        </button>
                    </form>
                </div>
            </aside>

            <!-- Results Section (Main Area) -->
            <section class="lg:col-span-3">
                <div class="bg-white/0 p-4 rounded-lg mb-4 flex items-center justify-between">
                    <h2 id="results-count" class="text-lg font-medium text-gray-700">Loading results...</h2>
                </div>
                <!-- Grid for displaying resource cards -->
                <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-6">
                    <!-- Dynamic Resource cards -->
                </div>
                <!-- No results message -->
                 <div id="no-results" class="hidden text-center py-16">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" /></svg>
                    <h3 class="mt-2 text-lg font-medium text-gray-900">No Results Found</h3>
                    <p class="mt-1 text-sm text-gray-500">Try adjusting your filters to find what you're looking for.</p>
                  </div>
                <!-- Loading Indicator -->
                <div id="loading-indicator" class="text-center py-16">
                    <svg class="animate-spin mx-auto h-8 w-8 text-brand-orange" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-2 text-gray-600">Loading data...</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Details Modal -->
    <div id="info-modal-container" class="fixed inset-0 z-40 hidden" role="dialog" aria-modal="true">
        <!-- Overlay -->
        <div id="modal-overlay" class="absolute inset-0 bg-gray-900 bg-opacity-75"></div>
        <!-- Modal Panel -->
        <div class="relative flex items-center justify-center min-h-screen p-4">
            <div id="info-modal" class="bg-white rounded-lg shadow-xl w-full max-w-2xl transform transition-all">
                <div class="p-6 sm:p-8">
                    <div class="flex items-start justify-between">
                        <h3 id="modal-title" class="text-2xl font-bold text-gray-900"></h3>
                        <!-- Close Button -->
                        <button id="modal-close-button" type="button" class="p-1 rounded-full text-gray-400 hover:bg-gray-200 hover:text-gray-600">
                            <span class="sr-only">Close</span>
                            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                    <div id="modal-content" class="mt-4 space-y-4">
                        <!-- Dynamic modal content -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            let database = [];
            
            const resultsGrid = document.getElementById('results-grid');
            const resultsCount = document.getElementById('results-count');
            const noResults = document.getElementById('no-results');
            const loadingIndicator = document.getElementById('loading-indicator');
            const filterForm = document.getElementById('filter-form');
            const areasOfSupportFilters = document.getElementById('areas-of-support-filters');
            const formatFilters = document.getElementById('format-filters');
            const priceFilters = document.getElementById('price-filters');
            const modalContainer = document.getElementById('info-modal-container');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const modalCloseButton = document.getElementById('modal-close-button');
            const modalOverlay = document.getElementById('modal-overlay');
            const resetButton = document.getElementById('reset-filters');

            let activeFilters = {
                'Areas of support': [],
                'Format': [],
                'Price': []
            };

            function createFilters() {
                const areas = [ 'Concentration and Focus', 'Organisation and Time management', 'Impulsivity and Hyperactivity', 'Processing and Memory', 'Communication and Social interaction', 'Routine, Structure, and Change', 'Movement and Co-ordination', 'Writing', 'Reading', 'Numbers and Mathematics', 'Auditory processing', 'Visual processing', 'Sensory sensitivity', 'Self-regulation, Managing Emotions, Confidence, and Self-esteem' ];
                const formats = [ 'Website', 'App', 'Hybrid system', 'Equipment', 'Software', 'Browser Extension', 'Feature' ];
                const prices = [ 'Free', 'Paid', 'Free with Paid options' ];

                const createFilterGroup = (container, items, groupName, initialLimit) => {
                    container.innerHTML = items.sort().map((item, index) => {
                        const isHidden = initialLimit && index >= initialLimit;
                        return `
                            <label class="flex items-center space-x-3 cursor-pointer ${isHidden ? 'hidden' : ''}" data-filter-item>
                                <input type="checkbox" value="${item}" data-group="${groupName}" class="h-4 w-4 rounded border-gray-300 text-brand-orange focus:ring-brand-orange">
                                <span class="text-sm text-gray-700">${item}</span>
                            </label>
                        `;
                    }).join('');

                    if (initialLimit && items.length > initialLimit) {
                        const showMoreButton = document.createElement('button');
                        showMoreButton.type = 'button';
                        showMoreButton.className = 'text-sm text-brand-orange hover:underline mt-2';
                        showMoreButton.textContent = `Show all ${items.length}`;
                        showMoreButton.dataset.action = 'toggle-filters';
                        showMoreButton.dataset.target = container.id;
                        container.insertAdjacentElement('afterend', showMoreButton);
                    }
                };
                
                createFilterGroup(areasOfSupportFilters, areas, 'Areas of support', 4);
                createFilterGroup(formatFilters, formats, 'Format', 4);
                createFilterGroup(priceFilters, prices, 'Price', null);
            }

            function renderResults() {
                const anyFilterActive = Object.values(activeFilters).some(arr => arr.length > 0);
                let filteredData;

                if (!anyFilterActive) {
                    filteredData = database;
                } else {
                    filteredData = database.filter(item => {
                        const areaMatch = activeFilters['Areas of support'].length === 0 || (Array.isArray(item['Areas of support']) && activeFilters['Areas of support'].every(value => item['Areas of support'].includes(value)));
                        const formatMatch = activeFilters['Format'].length === 0 || (Array.isArray(item['Format']) && activeFilters['Format'].every(value => item['Format'].includes(value)));
                        const priceMatch = activeFilters['Price'].length === 0 || (Array.isArray(item['Price']) && activeFilters['Price'].some(value => item['Price'].includes(value)));
                        return areaMatch && formatMatch && priceMatch;
                    });
                }

                resultsGrid.innerHTML = '';
                resultsCount.textContent = `${filteredData.length} Result${filteredData.length !== 1 ? 's' : ''}`;
                noResults.classList.toggle('hidden', filteredData.length > 0);

                filteredData.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col cursor-pointer';
                    // Updated badge colors to match the new theme
                    const createBadge = (text, bgColor, textColor) => `<span class="inline-block ${bgColor} ${textColor} text-xs font-medium mr-2 mb-2 px-2.5 py-0.5 rounded-full">${text}</span>`;
                    card.innerHTML = `
                        <div class="p-6 flex-grow">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">${item.Name}</h3>
                            <p class="text-gray-600 line-clamp-2 mb-4">${item.Summary}</p>
                        </div>
                        <div class="p-6 pt-0">
                            <div>
                                ${item['Areas of support'].slice(0, 3).map(area => createBadge(area, 'bg-orange-100', 'text-orange-800')).join('')}
                                ${item.Format.map(format => createBadge(format, 'bg-amber-100', 'text-amber-800')).join('')}
                                ${item.Price.map(price => createBadge(price, 'bg-purple-100', 'text-purple-800')).join('')}
                            </div>
                        </div>
                    `;
                    card.addEventListener('click', () => showModal(item));
                    resultsGrid.appendChild(card);
                });
            }

            function showModal(item) {
                modalTitle.textContent = item.Name;
                const detailSection = (title, content) => {
                    if (!content || (Array.isArray(content) && content.length === 0)) return '';
                    const contentHtml = Array.isArray(content) ? content.map(c => `<li class="py-1">${c}</li>`).join('') : `<p class="whitespace-pre-wrap">${content}</p>`;
                    const listClass = Array.isArray(content) ? 'list-disc list-inside' : '';
                    return `
                        <div>
                            <h4 class="font-semibold text-gray-700">${title}</h4>
                            <div class="text-gray-600 mt-1 ${listClass}">${contentHtml}</div>
                        </div>
                    `;
                };
                modalContent.innerHTML = `
                    ${detailSection('Summary', item.Summary)}
                    ${detailSection('Further info / notes', item['Further info / notes'])}
                    <div>
                        <a href="${item.Link}" target="_blank" rel="noopener noreferrer" class="inline-block mt-4 px-5 py-2.5 bg-brand-orange text-white font-medium rounded-lg hover:bg-brand-orange-dark transition-colors focus:ring-4 focus:ring-orange-300">
                            Visit Website
                        </a>
                    </div>
                `;
                modalContainer.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            function hideModal() {
                modalContainer.classList.add('hidden');
                document.body.style.overflow = '';
            }
            
            function handleFilterChange(e) {
                if (e.target.type === 'checkbox') {
                    const group = e.target.dataset.group;
                    const value = e.target.value;
                    const isChecked = e.target.checked;
                    if (isChecked) {
                        if (!activeFilters[group].includes(value)) activeFilters[group].push(value);
                    } else {
                        activeFilters[group] = activeFilters[group].filter(item => item !== value);
                    }
                    renderResults();
                }
            }

            async function initializeApp() {
                try {
                    const response = await fetch('database.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    database = await response.json();
                    createFilters();
                    renderResults();
                } catch (error) {
                    console.error("Failed to initialize the application:", error);
                    resultsGrid.innerHTML = `<p class="text-red-500">An error occurred while loading the data.</p>`;
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            }

            initializeApp();

            filterForm.addEventListener('input', handleFilterChange);
            
            filterForm.addEventListener('click', (e) => {
                if (e.target.dataset.action === 'toggle-filters') {
                    const targetId = e.target.dataset.target;
                    const container = document.getElementById(targetId);
                    const allItems = container.querySelectorAll('label[data-filter-item]');
                    const isShowingAll = e.target.textContent.startsWith('Show less');
                    
                    if (isShowingAll) {
                        allItems.forEach((item, index) => {
                            if (index >= 4) item.classList.add('hidden');
                        });
                        e.target.textContent = `Show all ${allItems.length}`;
                    } else {
                        allItems.forEach(item => item.classList.remove('hidden'));
                        e.target.textContent = 'Show less';
                    }
                }
            });

            resetButton.addEventListener('click', (e) => {
                e.preventDefault();
                filterForm.reset();
                activeFilters = { 'Areas of support': [], 'Format': [], 'Price': [] };
                renderResults();
            });

            modalCloseButton.addEventListener('click', hideModal);
            modalOverlay.addEventListener('click', hideModal);
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modalContainer.classList.contains('hidden')) hideModal();
            });
        });
    </script>
</body>
</html>
